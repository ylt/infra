---
# Create compatibility symlink for CSI drivers that hardcode /var/lib/kubelet
- name: k0s kubelet compatibility
  hosts: clients
  become: yes
  tasks:
    - name: Remove existing /var/lib/kubelet directory
      file:
        path: /var/lib/kubelet
        state: absent
      when: kube_node | bool

    - name: Create kubelet symlink for k0s compatibility
      file:
        src: /var/lib/k0s/kubelet
        dest: /var/lib/kubelet
        state: link
      when: kube_node | bool
