image:
  repository: ghcr.io/wez/govee2mqtt
  tag: latest
  pullPolicy: Always

serviceAccount:
  create: true

# Vault integration for Govee API credentials
vault:
  enabled: true
  role: govee2mqtt
  path: govee/credentials

env:
  TZ: Europe/London
  GOVEE_MQTT_HOST: mosquitto.mosquitto.svc.cluster.local
  GOVEE_MQTT_PORT: "1883"
  GOVEE_TEMPERATURE_SCALE: celsius
  # Credentials from Vault-synced secret
  GOVEE_API_KEY:
    valueFrom:
      secretKeyRef:
        name: govee2mqtt-credentials
        key: api_key
  GOVEE_EMAIL:
    valueFrom:
      secretKeyRef:
        name: govee2mqtt-credentials
        key: email
  GOVEE_PASSWORD:
    valueFrom:
      secretKeyRef:
        name: govee2mqtt-credentials
        key: password

# Fix permissions init container
initContainers:
  fix-permissions:
    image: busybox:latest
    command: ["sh", "-c", "chown -R 1000:1000 /data"]
    volumeMounts:
      - name: data
        mountPath: /data

# Host network for multicast LAN discovery
hostNetwork: true
dnsPolicy: ClusterFirstWithHostNet

service:
  main:
    ports:
      http:
        port: 8056

persistence:
  data:
    enabled: true
    type: pvc
    storageClass: longhorn
    size: 1Gi
    accessMode: ReadWriteOnce
    mountPath: /data

ingressRoute:
  main:
    enabled: true
    entryPoints:
      - websecure
    authentik: true
    routes:
      - match: Host(`govee.golden.wales`)
    tls: true

resources:
  requests:
    cpu: 100m
    memory: 128Mi
  limits:
    cpu: 200m
    memory: 256Mi
