image:
  repository: lscr.io/linuxserver/homeassistant
  tag: latest
  pullPolicy: Always

env:
  TZ: Europe/London
  PUID: "1000"
  PGID: "1000"

# Host network for device discovery
hostNetwork: true
dnsPolicy: ClusterFirstWithHostNet

# Privileged for hardware access
securityContext:
  privileged: true

# Prefer Pi 5 nodes
affinity:
  nodeAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        preference:
          matchExpressions:
            - key: kubernetes.io/hostname
              operator: In
              values:
                - node-5
                - node-6

serviceAccount:
  create: true

# Fix permissions init container
initContainers:
  fix-permissions:
    image: busybox:latest
    command: ["sh", "-c", "chown -R 1000:1000 /config"]
    volumeMounts:
      - name: config
        mountPath: /config

service:
  main:
    ports:
      http:
        port: 8123

persistence:
  config:
    enabled: true
    type: pvc
    storageClass: longhorn
    size: 10Gi
    accessMode: ReadWriteOnce
    mountPath: /config
  dbus:
    enabled: true
    type: hostPath
    hostPath: /run/dbus
    mountPath: /run/dbus
    readOnly: true
  localtime:
    enabled: true
    type: hostPath
    hostPath: /etc/localtime
    mountPath: /etc/localtime
    readOnly: true

ingressRoute:
  main:
    enabled: true
    entryPoints:
      - websecure
    authentik: false
    routes:
      - match: Host(`home.golden.wales`)
    tls: true

resources:
  requests:
    cpu: 500m
    memory: 1Gi
  limits:
    cpu: 2000m
    memory: 2Gi
