image:
  repository: eclipse-mosquitto
  tag: latest
  pullPolicy: Always

env:
  TZ: Europe/London

service:
  main:
    type: LoadBalancer
    ports:
      http:
        enabled: false
      mqtt:
        enabled: true
        port: 1883
        primary: true
      websocket:
        enabled: true
        port: 9001

persistence:
  data:
    enabled: true
    type: pvc
    storageClass: longhorn
    size: 1Gi
    accessMode: ReadWriteOnce
    mountPath: /mosquitto/data
  config:
    enabled: true
    type: configMap
    name: mosquitto-config
    mountPath: /mosquitto/config/mosquitto.conf
    subPath: mosquitto.conf

configmap:
  config:
    enabled: true
    data:
      mosquitto.conf: |
        # Mosquitto configuration file
        persistence true
        persistence_location /mosquitto/data/

        # MQTT listener
        listener 1883
        protocol mqtt

        # WebSocket listener
        listener 9001
        protocol websockets

        # Authentication (allow anonymous for now)
        allow_anonymous true

        # Logging
        log_dest stdout

ingressRoute:
  main:
    enabled: true
    entryPoints:
      - websecure
    authentik: false
    routes:
      - match: Host(`mqtt.golden.wales`)
    tls: true

resources:
  requests:
    cpu: 100m
    memory: 128Mi
  limits:
    cpu: 200m
    memory: 256Mi
